<?xml version="1.0" encoding="UTF-8"?>
<project name="sej" default="build" basedir="." xmlns:cs="antlib:com.puppycrawl.tools.checkstyle">
	<description>Builds, tests, and runs the project SEJ.</description>

	<property name="Name" value="SEJ" />
	<property name="name" value="sej" />
	<property name="dist.version" value="0.6.2" />

	<property name="src.dir" location="${basedir}/src" />
	<property name="lib.dir" location="${basedir}/lib" />
	<property name="conf.dir" location="${basedir}/conf" />
	<property name="doc.dir" location="${basedir}/doc" />
	<property name="src.classes.dir" location="${src.dir}/classes" />
	<property name="src.classes.gen.dir" location="${src.dir}/classes-gen" />
	<property name="src.classes14.dir" location="${src.dir}/classes14" />
	<property name="src.test-unit.dir" location="${src.dir}/test-unit" />
	<property name="src.test-system.dir" location="${src.dir}/test-system" />
	<property name="src.examples.dir" location="${src.dir}/examples" />
	<property name="src.doc.dir" location="${src.dir}/doc" />

	<!-- Targets -->

	<property name="javac.source" value="1.5" />
	<property name="javac.target" value="1.5" />

	<property name="build.dir" location="${basedir}/build" />
	<property name="build.classes.dir" location="${build.dir}/classes" />
	<property name="build.classes14.dir" location="${build.dir}/classes14" />
	<property name="build.test-unit.dir" location="${build.dir}/test-unit" />
	<property name="build.test-unit14.dir" location="${build.dir}/test-unit14" />
	<property name="build.test-system.dir" location="${build.dir}/test-system" />
	<property name="build.test-system14.dir" location="${build.dir}/test-system14" />
	<property name="build.examples.dir" location="${build.dir}/examples" />
	<property name="dist.dir" location="${basedir}/dist" />

	<property name="jar.file" location="${build.dir}/${name}.jar" />
	<property name="jar14.file" location="${build.dir}/${name}-jre1.4.jar" />
	<property name="jar.runtime.file" location="${build.dir}/${name}-runtime.jar" />
	<property name="jar14.runtime.file" location="${build.dir}/${name}-runtime-jre1.4.jar" />
	<property name="jar.src.file" location="${build.dir}/${name}-src.jar" />
	<property name="jar.doc.file" location="${build.dir}/${name}-doc.jar" />
	<!-- <property name="jar.manifest" location="${src.classes.dir}/manifest.mf" /> -->

	<property name="javadoc.dir" location="${doc.dir}/javadoc" />

	<path id="build.classpath">
		<fileset dir="${lib.dir}" includes="**/*.jar" />
		<fileset dir="${lib.dir}/build-only" includes="**/*.jar" />
	</path>
	<property name="build.classpath" refid="build.classpath" />
	
	<path id="cite.path">
		<dirset dir="${src.classes.dir}"/>
		<dirset dir="${src.test-system.dir}"/>
		<dirset dir="${src.examples.dir}"/>
	</path>
	<property name="src.cite.path" refid="cite.path" />

	<path id="lib.classpath">
		<fileset dir="${lib.dir}" includes="**/*.jar" />
	</path>
	<property name="lib.classpath" refid="lib.classpath" />

	<property file="build.conf" />

	<!-- ================================================================= -->
	<!-- prepare:                                                          -->
	<!-- Sets up directories and such for compilation                      -->
	<!-- ================================================================= -->

	<target name="prepare">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.classes.dir}" />
		<mkdir dir="${build.classes14.dir}" />

		<path id="run.classpath">
			<pathelement location="${conf.dir}" />
			<pathelement location="${build.classes.dir}" />
			<fileset dir="${lib.dir}" includes="**/*.jar" />
		</path>
		<property name="run.classpath" refid="run.classpath" />

		<path id="test.classpath">
			<pathelement location="${build.test-unit.dir}" />
			<pathelement location="${build.test-system.dir}" />
			<path refid="run.classpath" />
		</path>
		<property name="test.classpath" refid="test.classpath" />

		<path id="examples.classpath">
			<pathelement location="${build.examples.dir}" />
			<path refid="run.classpath" />
		</path>
		<property name="examples.classpath" refid="examples.classpath" />

		<tstamp>
			<format property="timestamp" pattern="yyyy/MM/dd HH:mm:ss z" locale="en" />
		</tstamp>
		<property name="dist.version.long" value="${dist.version} [${timestamp}]" />
	</target>

	<!-- ================================================================= -->
	<!-- generate:                                                         -->
	<!-- Generates source code                                             -->
	<!-- ================================================================= -->

	<taskdef classname="JFlex.anttask.JFlexTask" name="jflex" classpath="${build.classpath}" />
	<taskdef classname="java_cup.AntTask" name="cup" classpath="${build.classpath}" />

	<target name="lex" depends="prepare">
		<jflex file="${src.classes.dir}/sej/internal/spreadsheet/loader/excel/ExcelExpressionScannerA1.lex" destdir="${src.classes.gen.dir}" />
		<jflex file="${src.classes.dir}/sej/internal/spreadsheet/loader/excel/ExcelExpressionScannerR1C1.lex" destdir="${src.classes.gen.dir}" />
	</target>

	<target name="cup" depends="prepare, lex">
		<cup file="${src.classes.dir}/sej/internal/spreadsheet/loader/excel/ExcelExpressionParser.cup" dir="${src.classes.gen.dir}/sej/internal/spreadsheet/loader/excel" 
			parser="GeneratedParser" 
			symbols="GeneratedSymbols"
			nopositions="true"
			nosummary="true"
		/>
	</target>

	<target name="generate" depends="lex, cup">
		<mkdir dir="${src.classes.gen.dir}" />
	</target>

	<!-- ================================================================= -->
	<!-- compile:                                                          -->
	<!-- Compiles the source code                                          -->
	<!-- ================================================================= -->

	<target name="compile" depends="prepare, generate" description="Compiles the source code">

		<javac srcdir="${src.classes.dir}:${src.classes.gen.dir}" destdir="${build.classes.dir}" classpath="${build.classpath}" debug="true" deprecation="on" source="${javac.source}" target="${javac.target}">
			<include name="sej/**" />
		</javac>

		<javac srcdir="${src.classes14.dir}" destdir="${build.classes14.dir}" classpath="${build.classpath}" debug="true" deprecation="on" source="${javac.source}" target="${javac.target}">
			<include name="net/sf/retrotranslator/**" />
		</javac>

	</target>

	<!-- ================================================================= -->
	<!-- build:                                                            -->
	<!-- The default target                                                -->
	<!-- ================================================================= -->

	<target name="build" depends="jar,compile-tests,compile-examples" description="Builds the library target (default)">

	</target>

	<!-- ================================================================= -->
	<!-- validate:                                                         -->
	<!-- Validates source code                                             -->
	<!-- ================================================================= -->

	<target name="validate" depends="prepare, dependencies, style" description="Validates source">
	</target>

	<!-- ================================================================= -->
	<!-- dependencies:                                                     -->
	<!-- Checks component dependencies                                     -->
	<!-- ================================================================= -->

	<path id="macker.classpath">
		<fileset dir="J:/macker-0.4.2/lib" />
		<fileset dir="J:/macker-0.4.2/build" />
	</path>

	<taskdef name="macker" classname="net.innig.macker.ant.MackerAntTask" classpathref="macker.classpath" />

	<target name="dependencies" depends="prepare, compile, compile-tests, compile-examples">
		<macker>
			<rules dir="${src.dir}" includes="macker-rules.xml" />
			<classes dir="${build.classes.dir}">
				<include name="**/*.class" />
				<exclude name="**/CUP*.class" />
			</classes>
			<classes dir="${build.test-system.dir}">
				<include name="**/*.class" />
			</classes>
			<classes dir="${build.examples.dir}">
				<include name="**/*.class" />
			</classes>
		</macker>
	</target>

	<!-- ================================================================= -->
	<!-- style:                                                            -->
	<!-- Runs checkstyle                                                   -->
	<!-- ================================================================= -->

	<target name="style" depends="prepare" description="Runs checkstyle">
		<cs:checkstyle config="${src.dir}\checkstyle-config-apionly.xml">
			<fileset dir="${src.classes.dir}">
				<include name="**/*.java" />
				<exclude name="sej/internal/**/*.java" />
			</fileset>
		</cs:checkstyle>
		<cs:checkstyle config="${src.dir}\checkstyle-config.xml">
			<property key="checkstyle.header.file" file="${src.dir}\copyright-header.txt" />
			<fileset dir="${src.classes.dir}">
				<include name="**/*.java" />
			</fileset>
			<fileset dir="${src.test-unit.dir}">
				<include name="**/*.java" />
			</fileset>
			<fileset dir="${src.test-system.dir}">
				<include name="**/*.java" />
			</fileset>
			<fileset dir="${src.examples.dir}">
				<include name="**/*.java" />
			</fileset>
		</cs:checkstyle>
	</target>



	<!-- ================================================================= -->
	<!-- jar:                                                              -->
	<!-- Creates jar file                                                  -->
	<!-- ================================================================= -->

	<target name="jar" depends="validate, compile" description="Creates a jar file">

		<delete file="${jar.file}" />
		<jar jarfile="${jar.file}" compress="true">
			<fileset dir="${build.classes.dir}" >
				<exclude name="net/sf/retrotranslator/**"/>
			</fileset>
		</jar>

		<delete file="${jar.runtime.file}" />
		<jar jarfile="${jar.runtime.file}" compress="true">
			<fileset dir="${build.classes.dir}">
				<include name="sej/runtime/*.class" />
				<include name="sej/internal/runtime/*.class" />
				<include name="sej/internal/bytecode/runtime/*.class" />
				<exclude name="net/sf/retrotranslator/**"/>
			</fileset>
		</jar>

	</target>

	<!-- ================================================================= -->
	<!-- jar14:                                                            -->
	<!-- Build retrofitted version                                         -->
	<!-- ================================================================= -->

	<target name="jar14" depends="jar" description="Retrofits the compiled code for Java 1.4">

		<delete file="${jar14.file}" />
		<java classname="net.sf.retrotranslator.transformer.Retrotranslator" classpath="${build.classpath}:${build.classes14.dir}" failonerror="yes">
			<arg value="-srcjar" />
			<arg file="${jar.file}" />
			<arg value="-srcjar" />
			<arg file="${lib.dir}/build-only/retrotranslator-runtime-1.0.4.jar" />
			<arg value="-srcdir" />
			<arg file="${build.classes14.dir}" />
			<arg value="-destjar" />
			<arg file="${jar14.file}" />
			<arg value="-stripsign" />
			<arg value="-lazy" />
			<arg value="-verify" />
			<arg value="-classpath" />
			<arg value="${jar14.file}" />
			<arg value="-classpath" />
			<arg value="${lib.classpath}" />
			<arg value="-classpath" />
			<arg value="${lib.dir}/build-only/backport-util-concurrent.jar" />
			<arg value="-classpath" />
			<arg value="${java14.home.dir}/lib/rt.jar" />
		</java>

		<delete file="${jar14.runtime.file}" />
		<java classname="net.sf.retrotranslator.transformer.Retrotranslator" classpath="${build.classpath}:${build.classes14.dir}" failonerror="yes">
			<arg value="-srcjar" />
			<arg file="${jar.runtime.file}" />
			<arg value="-srcjar" />
			<arg file="${lib.dir}/build-only/retrotranslator-runtime-1.0.4.jar" />
			<arg value="-srcdir" />
			<arg file="${build.classes14.dir}" />
			<arg value="-destjar" />
			<arg file="${jar14.runtime.file}" />
			<arg value="-stripsign" />
			<arg value="-lazy" />
			<arg value="-verify" />
			<arg value="-classpath" />
			<arg value="${jar14.runtime.file}" />
			<arg value="-classpath" />
			<arg value="${lib.dir}/build-only/backport-util-concurrent.jar" />
			<arg value="-classpath" />
			<arg value="${java14.home.dir}/lib/rt.jar" />
		</java>

	</target>

	<!-- ================================================================= -->
	<!-- srcjar:                                                           -->
	<!-- Create jar file with source code                                  -->
	<!-- ================================================================= -->

	<target name="srcjar" depends="prepare, validate, javadoc" description="Creates a jar file with the product source code in it">

		<delete file="${jar.src.file}" />
		<jar jarfile="${jar.src.file}" compress="true">
			<fileset dir="${src.classes.dir}" >
				<include name="**/*.java"/>
				<exclude name="net/sf/retrotranslator/**"/>
			</fileset>
			<fileset dir="${src.classes.gen.dir}" >
				<include name="**/*.java"/>
			</fileset>
		</jar>

		<delete file="${jar.doc.file}" />
		<jar jarfile="${jar.doc.file}" compress="true">
			<fileset dir="${javadoc.dir}" >
			</fileset>
		</jar>

	</target>

	<!-- ================================================================= -->
	<!-- test:                                                             -->
	<!-- Runs JUnit test suites                                            -->
	<!-- ================================================================= -->

	<target name="compile-tests" depends="prepare, compile">

		<mkdir dir="${build.test-unit.dir}" />
		<mkdir dir="${build.test-system.dir}" />

		<javac srcdir="${src.test-unit.dir}" destdir="${build.test-unit.dir}" classpath="${test.classpath}" debug="true" deprecation="on" source="${javac.source}" target="${javac.target}">
			<include name="sej/**" />
		</javac>
		<javac srcdir="${src.test-system.dir}" destdir="${build.test-system.dir}" classpath="${test.classpath}" debug="true" deprecation="on" source="${javac.source}" target="${javac.target}">
			<include name="sej/**" />
		</javac>
	</target>

	<target name="test" depends="prepare, jar, compile-tests" description="Runs JUnit test suites">

		<taskdef name="junit" classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask" classpath="${lib.classpath}" />

		<junit printsummary="no" showoutput="no" haltonerror="yes" haltonfailure="yes" fork="yes" forkmode="once" dir=".">

			<formatter type="plain" usefile="no" />
			<classpath>
				<path refid="build.classpath" />
				<pathelement path="${build.test-unit.dir}" />
				<pathelement path="${build.test-system.dir}" />
				<pathelement location="${jar.file}" />
			</classpath>

			<batchtest>
				<fileset dir="${build.test-unit.dir}">
					<include name="**/*Test.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
				</fileset>
				<fileset dir="${build.test-system.dir}">
					<include name="**/*Test*.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
					<exclude name="**/*DeserializationTest.class" />
				</fileset>
			</batchtest>

		</junit>

		<junit printsummary="no" showoutput="no" haltonerror="yes" haltonfailure="yes" fork="yes" forkmode="once" dir=".">

			<formatter type="plain" usefile="no" />
			<classpath>
				<path refid="build.classpath" />
				<pathelement path="${build.test-system.dir}" />
				<pathelement location="${jar.runtime.file}" />
			</classpath>

			<batchtest>
				<fileset dir="${build.test-system.dir}">
					<include name="**/*DeserializationTest.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
				</fileset>
			</batchtest>

		</junit>

	</target>

	<!-- ================================================================= -->
	<!-- test14:                                                           -->
	<!-- Runs JUnit test suites using JRE 1.4                              -->
	<!-- ================================================================= -->

	<target name="compile-tests14" depends="compile-tests">

		<mkdir dir="${build.test-unit14.dir}" />
		<mkdir dir="${build.test-system14.dir}" />

		<java classname="net.sf.retrotranslator.transformer.Retrotranslator" classpath="${build.classpath}:${build.classes14.dir}" failonerror="yes">
			<arg value="-srcdir" />
			<arg path="${build.test-unit.dir}" />
			<arg value="-destdir" />
			<arg path="${build.test-unit14.dir}" />
			<arg value="-stripsign" />
			<arg value="-lazy" />
		</java>

		<java classname="net.sf.retrotranslator.transformer.Retrotranslator" classpath="${build.classpath}:${build.classes14.dir}" failonerror="yes">
			<arg value="-srcdir" />
			<arg path="${build.test-system.dir}" />
			<arg value="-destdir" />
			<arg path="${build.test-system14.dir}" />
			<arg value="-stripsign" />
			<arg value="-lazy" />
		</java>
	</target>

	<target name="test14" depends="prepare, jar14, compile-tests14" description="Runs JUnit test suites">

		<taskdef name="junit" classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask" classpath="${test.classpath14}" />

		<junit printsummary="no" showoutput="no" haltonerror="yes" haltonfailure="yes" fork="yes" forkmode="once" jvm="${java14.home.dir}\bin\java" dir=".">

			<formatter type="plain" usefile="no" />
			<classpath>
				<path refid="build.classpath" />
				<pathelement path="${build.test-unit14.dir}" />
				<pathelement path="${build.test-system14.dir}" />
				<pathelement location="${jar14.file}" />
			</classpath>

			<batchtest>
				<fileset dir="${build.test-unit14.dir}">
					<include name="**/*Test.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
				</fileset>
				<fileset dir="${build.test-system14.dir}">
					<include name="**/*Test*.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
					<exclude name="**/*DeserializationTest.class" />
				</fileset>
			</batchtest>

		</junit>

		<junit printsummary="no" showoutput="no" haltonerror="yes" haltonfailure="yes" fork="yes" forkmode="once" jvm="${java14.home.dir}\bin\java" dir=".">

			<formatter type="plain" usefile="no" />
			<classpath>
				<path refid="build.classpath" />
				<pathelement path="${build.test-system14.dir}" />
				<pathelement location="${jar14.runtime.file}" />
			</classpath>

			<batchtest>
				<fileset dir="${build.test-system.dir}">
					<include name="**/*DeserializationTest.class" />
					<exclude name="**/Abstract*" />
					<exclude name="**/*$*" />
				</fileset>
			</batchtest>

		</junit>

	</target>

	<!-- ================================================================= -->
	<!-- examples:                                                         -->
	<!-- Compiles examples                                                 -->
	<!-- ================================================================= -->

	<target name="compile-examples" depends="prepare, compile">

		<mkdir dir="${build.examples.dir}" />

		<javac srcdir="${src.examples.dir}" destdir="${build.examples.dir}" classpath="${examples.classpath}" debug="true" deprecation="on" source="${javac.source}" target="${javac.target}">
			<include name="**" />
		</javac>
	</target>

	<target name="examples" depends="compile-examples" description="Compiles examples">
	</target>

	<!-- ================================================================= -->
	<!-- javadoc:                                                          -->
	<!-- Generates javadoc                                                 -->
	<!-- ================================================================= -->

	<target name="javadoc" description="Builds javadoc" depends="prepare, doc">

		<property name="javadoc.title" value="${Name} API ${dist.version.long}" />
		<delete dir="${javadoc.dir}" />
		<mkdir dir="${javadoc.dir}" />

		<javadoc 
			sourcepath="${src.classes.dir}" 
			destdir="${javadoc.dir}" 
			public="true" 
			windowtitle="${javadoc.title}" 
			use="true"
			packagenames="sej,sej.runtime,sej.describable,sej.expressions"
			additionalParam="-tagletPath ${lib.dir}/build-only/java2html.jar;${lib.dir}/build-only/jcite.jar;${lib.dir}/jxl.jar -taglet ch.arrenbrecht.jcite.JCiteTaglet -J-Djcitesourcepath=${src.cite.path}"
			stylesheetfile="${src.doc.dir}/plainstyle/style.css"
			overview="${src.classes.dir}/overview.html"
		>
			<classpath refid="build.classpath" />
			<link href="http://java.sun.com/j2se/1.5/docs/api/" />
		</javadoc>
		
		<copy todir="${javadoc.dir}">
			<fileset dir="${src.classes.dir}">
				<include name="**/*.gif" />
				<include name="**/*.jpeg" />
				<include name="**/*.jpg" />
				<include name="**/*.png" />
				<include name="**/*.pdf" />
				<include name="**/*.svg" />
			</fileset>
		</copy>

	</target>

	<!-- ================================================================= -->
	<!-- doc:                                                              -->
	<!-- Generates documentation                                           -->
	<!-- ================================================================= -->

	<target name="doc" description="Builds documentation" depends="prepare, examples">

		<delete dir="${doc.dir}" />
		<mkdir dir="${doc.dir}" />
		<copy todir="${doc.dir}">
			<fileset dir="${src.doc.dir}">
				<include name="**/*.gif" />
				<include name="**/*.jpeg" />
				<include name="**/*.jpg" />
				<include name="**/*.png" />
				<include name="**/*.pdf" />
				<include name="**/*.svg" />
				<include name="**/*.html" />
				<include name="**/*.htm" />
				<include name="**/*.css" />
			</fileset>
		</copy>

		<java classname="ch.arrenbrecht.jcite.JCite" classpath="${build.classpath}" failonerror="yes">
			<arg value="-sp" />
			<arg path="${src.classes.dir}" />
			<arg value="-sp" />
			<arg path="${src.examples.dir}" />
			<arg value="-sp" />
			<arg path="${src.test-system.dir}" />
			<arg value="-r" />
			<arg value="-i" />
			<arg file="${src.doc.dir}/*.htm" />
			<arg value="-o" />
			<arg file="${doc.dir}" />
		</java>

		<replace dir="${doc.dir}">
			<include name="**/*.htm" />
			<replacetoken><![CDATA[<a href="dist/]]></replacetoken>
			<replacevalue><![CDATA[<a href="../dist/]]></replacevalue>
		</replace>
	</target>

	<!-- ================================================================= -->
	<!-- clean:                                                            -->
	<!-- Removes all build files                                           -->
	<!-- ================================================================= -->

	<target name="clean" description="Removes all build files">
		<delete dir="${doc.dir}" />
		<delete dir="${build.classes.dir}" />
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}" />
		<delete dir="${src.classes.gen.dir}" />
		<mkdir dir="${src.classes.gen.dir}" />
		<mkdir dir="${build.dir}/dev" />  <!-- make Eclipse happy -->
	</target>

	<!-- ================================================================= -->
	<!-- dist:                                                             -->
	<!-- Package distribution version                                      -->
	<!-- ================================================================= -->

	<target name="dist" depends="clean,compile,validate,jar,doc,javadoc,test,jar14,test14,examples,srcjar" description="Builds distribution">
		<echo>Bundling dist: ${dist.version.long}</echo>
		<property name="dist.name" value="${name}-${dist.version}" />
		<property name="dist.file" value="${dist.dir}/${dist.name}" />

		<property name="dist.tmp.dir" value="${dist.dir}/tmp" />
		<property name="dist.staging.dir" value="${dist.tmp.dir}/${dist.name}" />

		<!-- binary -->
		<delete dir="${dist.tmp.dir}" />
		<mkdir dir="${dist.staging.dir}" />
		<copy todir="${dist.staging.dir}">
			<fileset dir="${basedir}">
				<include name="lib/*" />
				<include name="build/*.jar" />
				<exclude name="build/sej-src.jar" />
				<exclude name="build/sej-doc.jar" />
				<include name="*.html" />
				<include name="*.css" />
				<include name="doc/**" />
				<exclude name="**/.DS_Store" />
			</fileset>
		</copy>
		<copy todir="${dist.staging.dir}" overwrite="yes">
			<filterset>
				<filter token="dist.version" value="${dist.version}" />
				<filter token="dist.version.long" value="${dist.version.long}" />
			</filterset>
			<fileset dir="${basedir}" includes="README.html" />
		</copy>
		<!-- tar basedir="${dist.tmp.dir}" destfile="${dist.file}-bin.tar.gz" compression="gzip" longfile="gnu" / -->
		<zip basedir="${dist.tmp.dir}" destfile="${dist.file}-bin.zip" filesonly="no" />

		<!-- source -->
		<delete dir="${dist.tmp.dir}" />
		<mkdir dir="${dist.staging.dir}" />
		<copy todir="${dist.staging.dir}">
			<fileset dir="${basedir}">
				<include name="lib/*" />
				<include name="lib/build-only/*" />
				<include name="*.html" />
				<include name="*.css" />
				<include name="src/**" />
				<include name="build.xml" />
				<include name="build.conf" />
				<exclude name="**/.DS_Store" />
			</fileset>
		</copy>
		<copy todir="${dist.staging.dir}" overwrite="yes">
			<filterset>
				<filter token="dist.version" value="${dist.version}" />
				<filter token="dist.version.long" value="${dist.version.long}" />
			</filterset>
			<fileset dir="${basedir}" includes="README.html" />
		</copy>
		<!-- tar basedir="${dist.tmp.dir}" destfile="${dist.file}-src.tar.gz" compression="gzip" longfile="gnu" / -->
		<zip basedir="${dist.tmp.dir}" destfile="${dist.file}-src.zip" filesonly="no" />

		<delete dir="${dist.tmp.dir}" />

		<!-- zipped source -->
		<delete dir="${dist.tmp.dir}" />
		<mkdir dir="${dist.staging.dir}" />
		<copy todir="${dist.staging.dir}">
			<fileset dir="${basedir}">
				<include name="build/sej-src.jar" />
				<include name="build/sej-doc.jar" />
			</fileset>
		</copy>
		<copy todir="${dist.staging.dir}" overwrite="yes">
			<fileset dir="${basedir}" includes="LICENSE.html" />
		</copy>
		<!-- tar basedir="${dist.tmp.dir}" destfile="${dist.file}-srcjar.tar.gz" compression="gzip" longfile="gnu" / -->
		<zip basedir="${dist.tmp.dir}" destfile="${dist.file}-srcjar.zip" filesonly="no" />

		<delete dir="${dist.tmp.dir}" />
		
		<copy todir="${dist.dir}">
			<fileset dir="${src.test-system.dir}/testdata/sej" includes="Tests.xls" />
		</copy>
		
	</target>

</project>
