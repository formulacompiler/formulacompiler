--- # WARNING: THIS FILE MUST NOT CONTAIN HARD TABS!
groups:

  - id: ext
    desc:
        External libraries used by SEJ.
    unchecked: true
    color: aquamarine4
    comps:

      - id: asm.core
        jars:
          - asm.jar
          - asm-commons.jar
        pkgs:
          - org.objectweb.asm
          - org.objectweb.asm.commons

      - id: jode
        jars:
          - jode-decompiler.jar
        pkgs:
          - net.sf.jode.bytecode
          - net.sf.jode.decompiler

      - id: javacup.runtime
        jars:
          - java-cup-runtime.jar
        pkgs:
          - java_cup.runtime

      - id: jexcelapi
        jars:
          - jxl.jar
        pkgs:
          - jxl
          - jxl.format
          - jxl.read
          - jxl.read.biff
          - jxl.write
          - jxl.write.biff
          - jxl.biff.formula

  - id: core
    desc:
        SEJ's functional model to byte code compiler and runtime.
    notes:
        The spreadsheet compiler sits on top of this and first transforms a spreadsheet
        into a functional model.
    groups:

      - id: runtime
        jar: sej-runtime
        color: brown1
        desc:
            All the components needed to run compiled engines.
        comps:

          - id: api
            pkgs:
              - sej.runtime

          - id: core
            pkgs:
              - sej.internal.runtime
            api_deps:
              - core.runtime.api

          - id: jvm
            pkgs:
              - sej.internal.bytecode.runtime
            api_deps:
              - core.runtime.api
            deps:
              - core.runtime.core

      - id: compiler
        jar: sej-compiler
        color: chocolate1
        desc:
            Functional model to byte code compiler.
        notes:
            Does not have a fully sufficient public API yet.
            In particular, the functional model itself is not yet exposed.
        comps:

          - id: describable
            pkgs:
              - sej.describable

          - id: api
            pkgs:
              - sej.compiler
            api_deps:
              - core.runtime.api
              - core.compiler.describable

          - id: logging
            pkgs:
              - sej.internal.logging

          - id: core
            pkgs:
              - sej.internal
            api_deps:
              - core.compiler.api
              - core.compiler.logging
            deps:
              - core.runtime.core
              - ext.asm.core

          - id: expressions
            pkgs:
              - sej.internal.expressions
            api_deps:
              - core.compiler.core

          - id: templates
            desc:
                Template native Java implementations of low-level functions.
            notes:
                Used directly by the generated expression interpreters
                and as templates for the generated bytecode compilers.
            pkgs:
              - sej.internal.templates
            deps:
              - core.runtime.core

          - id: model
            pkgs:
              - sej.internal.model
            api_deps:
              - core.compiler.expressions

          - id: compiler
            desc:
                Abstract two-stage compiler - delegates both an initial model transform and
                then transformed model to bytecode compilation.
            pkgs:
              - sej.internal.engine.compiler
            api_deps:
              - core.compiler.model

          - id: interpreter
            desc:
                Interprets expressions at compile-time to do constant-folding.
            pkgs:
              - sej.internal.model.interpreter
            api_deps:
              - core.compiler.model
            deps:
              - core.compiler.templates
              - core.runtime.core

          - id: analysis
            desc:
                Performs data type analysis.
            pkgs:
              - sej.internal.model.analysis
            deps:
              - core.compiler.model

          - id: rewriting
            desc:
                Rewrites higher-level expressions in terms of lower-level constructs.
            pkgs:
              - sej.internal.model.rewriting
            api_deps:
              - core.compiler.model
            deps:
              - core.compiler.analysis
              - core.compiler.interpreter

          - id: optimizer
            desc:
                Performs constant-folding.
            pkgs:
              - sej.internal.model.optimizer
              - sej.internal.model.optimizer.consteval
            api_deps:
              - core.compiler.model
            deps:
              - core.compiler.interpreter

          - id: transformer
            desc:
                Implements the first stage of the abstract two-stage compiler.
            pkgs:
              - sej.internal.model.transformer
            api_deps:
              - core.compiler.compiler
            deps:
              - core.compiler.interpreter
              - core.compiler.analysis
              - core.compiler.optimizer
              - core.compiler.rewriting

          - id: jvm
            desc:
                Compiles a transformed model to byte code.
            pkgs:
              - sej.internal.bytecode.compiler
            api_deps:
              - core.compiler.model
              - core.compiler.compiler
            deps:
              - core.runtime.core
              - core.runtime.jvm
              - ext.asm.core

      - id: decompiler
        jar: sej-decompiler
        color: burlywood1
        desc:
            Byte code engine decompiler.
        comps:

          - id: api
            pkgs:
              - sej.decompiler
            api_deps:
              - core.runtime.api

          - id: jvm
            pkgs:
              - sej.internal.bytecode.decompiler
            api_deps:
              - core.decompiler.api
            deps:
              - core.runtime.jvm
              - ext.jode

  - id: spreadsheet
    desc:
        SEJ's spreadsheet to functional model and - in the end - bytecode engine compiler.
    groups:

      - id: compiler
        jar: sej-spreadsheet
        color: cadetblue1
        desc:
            The core compiler which does everything except load and save spreadsheets in the
            different supported file formats.
        comps:

          - id: api
            pkgs:
              - sej.spreadsheet
            api_deps:
              - core.compiler.api

          - id: model
            desc:
                Implements the abstract internal model of a spreadsheet.
            pkgs:
              - sej.internal.spreadsheet
            api_deps:
              - spreadsheet.compiler.api
              - core.compiler.expressions

          - id: binding
            desc:
                Defines a binding of spreadsheet model elements to the user's own Java classes.
            pkgs:
              - sej.internal.spreadsheet.binding
            api_deps:
              - spreadsheet.compiler.model

          - id: binder
            desc:
                Used to create a spreadsheet binding.
            pkgs:
              - sej.internal.spreadsheet.binder
            api_deps:
              - spreadsheet.compiler.binding

          - id: builder
            desc:
                Used to create internal spreadsheet models from scratch.
            pkgs:
              - sej.internal.spreadsheet.builder
            api_deps:
              - spreadsheet.compiler.api
            deps:
              - spreadsheet.compiler.model

          - id: compiler
            desc:
                Compiles a spreadsheet model to a bytecode engine by way of first compiling to a functional model
                and then using SEJ's functional model compiler on that.
            pkgs:
              - sej.internal.spreadsheet.compiler
            api_deps:
              - spreadsheet.compiler.api
            deps:
              - spreadsheet.compiler.model
              - spreadsheet.compiler.binding
              - core.compiler.model
              - core.compiler.compiler

          - id: util
            desc:
                Convenience classes implementing simplified API for SEJ.
            pkgs:
              - sej.internal.spreadsheet.util
            api_deps:
              - spreadsheet.compiler.api

          - id: parser
            desc:
                Base for the spreadsheet function parsers following Excel and OpenFormula specification.
            pkgs:
              - sej.internal.spreadsheet.loader.excel
            api_deps:
              - spreadsheet.compiler.model
            deps:
              - ext.javacup.runtime

          - id: load
            desc:
                Spreadsheet loader implementation that dispatches to actual specific loader implementations by file extension.
            pkgs:
              - sej.internal.spreadsheet.loader
            api_deps:
              - spreadsheet.compiler.api

          - id: save
            desc:
                Spreadsheet saver implementation that dispatches to actual specific saver implementations by file extension.
            pkgs:
              - sej.internal.spreadsheet.saver
            api_deps:
              - spreadsheet.compiler.api
              - core.compiler.expressions

      - id: excel.xls
        jar: sej-spreadsheet-excel-xls
        color: cyan3
        desc:
            Excel .xls file format handlers.
        comps:

          - id: load
            pkgs:
              - sej.internal.spreadsheet.loader.excel.xls
            api_deps:
              - spreadsheet.compiler.load
            deps:
              - spreadsheet.compiler.model
              - spreadsheet.compiler.parser
              - core.runtime.core
              - ext.jexcelapi

          - id: save
            pkgs:
              - sej.internal.spreadsheet.saver.excel.xls
            api_deps:
              - spreadsheet.compiler.save
            deps:
              - spreadsheet.compiler.model
              - ext.jexcelapi

...
